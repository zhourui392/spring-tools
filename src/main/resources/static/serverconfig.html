<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>列表页</title>	<meta name="description" content="">
	<link type="text/css" href="css/bootstrap.min.css" rel="stylesheet" />
	<link type="text/css" href="css/bootstrapSwitch.css" rel="stylesheet" />
	<link type="text/css" href="css/common.css" rel="stylesheet" />
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootstrapSwitch.js"></script>
    <script type="text/javascript" src="js/script.js"></script>
    <script type="text/javascript" src="js/ComfirmDialog.js"></script>
    
</head>
<body>
<!-- 顶部 header -->
	<header>
		<h1><a href="#"><img alt="" src="images/logo.png" /></a></h1>
	</header>

<!-- 主体部分 -->
	<div class="main">
		<div class="left_menu">
			<ul>
				<li onclick="location.href='hospitalopt.html'"><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;医院管理</li>
				<li class="active" onclick="location.href='serverconfig.html'"><span class="glyphicon glyphicon-cog active"></span>&nbsp;&nbsp;配置</li>
				<li onclick="location.href='uploadrecord.html'"><span class="glyphicon  glyphicon-upload active"></span>&nbsp;&nbsp;上传记录</li>
				<li onclick="location.href='downloadrecord.html'"><span class="glyphicon  glyphicon-download active"></span>&nbsp;&nbsp;下载记录</li>
			</ul>
		</div>
		<div class="content_wrap">
			<h2>资料</h2>
			<div class="setting_title">
				<div class="form-group">
					<label class="col-sm-3 control-label" style="width:80px;">配置类型：</label>
					<div class="col-sm-9"> 
						<select class="form-control" id="catetoryList" style="width: 250px;">
						</select>
					</div>
						
				</div>
			</div>
			<form class="form-horizontal mt50" role="form" style="margin-top: 10px;">
				<div class="col-sm-5" style="width: 600px;border: gray 1px dotted;padding: 20px 20px 10px 10px;">
					<div id="configArea">
					</div>
					<div class="form-group">
						<button type="button" class="btn btn-success fr mr15 mt35 submitconfigbtn"><span class="glyphicon glyphicon-ok"></span> 确 定</button>
					</div>
				</div>
				
			</form>
		</div>
	</div>
	
	<script type="text/javascript">
		$(".trValueList").html("");
		
		$(function(){
			refreshTable();
			
			//提交
			$(".submitconfigbtn").click(function(){
				var category = $("#catetoryList").val();
				var serverconfigNameList = new Array();
				$("input.serverconfigName").each(function(){
					serverconfigNameList.push($(this).val());
				});
				
				var serverconfigIdList = new Array();
				$("input.serverconfigId").each(function(){
					serverconfigIdList.push($(this).val());
				});
				var json = {
						serverconfigNameList : serverconfigNameList.toString(),
						serverconfigIdList : serverconfigIdList.toString()
				};
				//加载配置类型
				$.ajax({
		             url: "saveServerconfigByCategory",
		             dataType: "json",
		             type: "POST",
		             data:json,
		             success: function (data) {
		                 if (data.status == 1){
		                	 refreshTable();
		                 }else{
		                	 alert("修改信息失败");
		                 }
		             }
				});
			});
			
			$("#catetoryList").change(function(){
				//加载当前选中的配置类型下的配置
           	 	loadConfigForCatetory($("#catetoryList").val());
			});
		});
		
		function refreshTable(){
			//加载配置类型
			$.ajax({
	             url: "serverconfigcategory",
	             dataType: "json",
	             type: "GET",
	             success: function (data) {
	                 if (data.status == 1){
	                	 var categoryHtml = "";
	                	 var categoryList = data.data;
	                	 for (var index in categoryList){
	                		 var category = categoryList[index];
	                		 categoryHtml += "<option value='"+category+"'>"+category+"</option>";
	                	 }
	                	 $("#catetoryList").html(categoryHtml);
	                	 
	                	 //加载当前选中的配置类型下的配置
	                	 loadConfigForCatetory($("#catetoryList").val());
	                	 
	                 }else{
	                	 $("#catetoryList").html("<option>无配置信息</option>");
	                 }
	             }
			});
		}
		
		function loadConfigForCatetory(category){
			var json = {
				category:category
           	 };
			//加载配置类型
			$.ajax({
	             url: "serverconfigbycategory",
	             dataType: "json",
	             data:json,
	             type: "POST",
	             success: function (data) {
	            	 var serverConfigHtml = "";
	                 if (data.status == 1){
	                	 var serverconfigList = data.data;
	                	 for (var index in serverconfigList){
	                		 var serverconfig = serverconfigList[index];
	                		 
	                		 serverConfigHtml += "<div class='form-group'><label class='col-sm-3 control-label' style='line-height:32px;'>"+serverconfig.name+"：</label>";	
	                		 serverConfigHtml += "<div class=’col-sm-9‘>";
	                		 serverConfigHtml += "<input type='hidden' name='serverconfigId' class='serverconfigId' value='"+serverconfig.id+"'>";
	                		 serverConfigHtml += "<input type='text' style='width:290px;' class='form-control serverconfigName' id='email'  value='"+serverconfig.value+"'>";
	                		 serverConfigHtml += "<div style='margin-left:140px;'>";
	                		 serverConfigHtml += "<p class='help-block' style='left: 20px;position: relative;line-height: 30px;'>"+serverconfig.memo+"</p>"; 
	                		 serverConfigHtml += "</div>";
	                		 serverConfigHtml += "</div>";
	                		 serverConfigHtml += "</div>";
	                	 }
	                	  $("#configArea").html(serverConfigHtml);
	                	 if (data.data == "" || data.data == null){
	                		  $("#configArea").html(serverConfigHtml);
	                	 }
	                 }
	               
	             }
			});
		}
		Date.prototype.format = function(format) {
			var o = {
				"M+" : this.getMonth() + 1, // month
				"d+" : this.getDate(), // day
				"h+" : this.getHours(), // hour
				"m+" : this.getMinutes(), // minute
				"s+" : this.getSeconds(), // second
				"q+" : Math.floor((this.getMonth() + 3) / 3), // quarter
				"S" : this.getMilliseconds()
			// millisecond
			}

			if (/(y+)/.test(format)) {
				format = format.replace(RegExp.$1, (this.getFullYear() + "")
						.substr(4 - RegExp.$1.length));
			}

			for ( var k in o) {
				if (new RegExp("(" + k + ")").test(format)) {
					format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k]
							: ("00" + o[k]).substr(("" + o[k]).length));
				}
			}
			return format;
		} 
	</script>
</body>
</html>